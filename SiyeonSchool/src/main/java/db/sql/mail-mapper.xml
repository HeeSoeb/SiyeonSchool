<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>

	<!-- "받은메일함 메일갯수" 조회 : "메일함 소유자번호"로 조회 -->
	<entry key="selectInboxMailListCount">
		SELECT COUNT(MAIL_NO) AS "COUNT"
		  FROM MAIL_OWNER MO
		  JOIN MAIL M USING(MAIL_NO)
		 WHERE MO.MAILBOX_NO = ( SELECT MAILBOX_NO
                                   FROM MAILBOX
                                  WHERE OWNER_NO = ?
                                    AND MAILBOX_NAME = '받은메일함' )
		   AND MO.MAIL_STATUS = 'Y'
		   AND M.IS_SENT = 'S'
	</entry>

	<!-- "받은메일함 메일목록" 조회 : "메일함 소유자번호"로 조회 -->
	<entry key="selectInboxMailList">
		SELECT *
		  FROM (
			     SELECT ROWNUM RNUM, A.*
			     FROM (
						SELECT 
							   M.MAIL_NO
							 , MO.MAIL_STAR
							 , NVL2(MR.READ_TIME, 'Y', 'N') AS "IS_READ"
							 , U.USER_NAME
							 , U.USER_ID
							 , A.FILE_PATH || A.CHANGE_NAME AS "PROFILE_PATH"
							 , M.MAIL_TITLE
							 , DECODE(MR.RECEIVER_TYPE, 'R', '수신', 'C', '참조', 'S', '비밀') AS "RECEIVER_TYPE"
							 , TO_CHAR(M.SEND_DATE, 'YYYY-MM-DD DY HH24:MI') AS "SEND_DATE"
						  FROM MAIL M
						  LEFT JOIN MAIL_RECEIVER MR ON M.MAIL_NO = MR.MAIL_NO
						  JOIN USERS U ON M.SENDER = U.USER_NO
						  LEFT JOIN ATTACHMENT A ON U.PROFILE_FILE_NO = A.FILE_NO
						  JOIN MAILBOX MB ON MB.OWNER_NO = MR.RECEIVER_NO
						  JOIN MAIL_OWNER MO ON (MO.MAIL_NO = M.MAIL_NO AND MO.OWNER_NO = MB.OWNER_NO)
						 WHERE 
							   MB.MAILBOX_NAME = '받은메일함' 
							   AND MB.OWNER_NO = ?
							   AND M.IS_SENT = 'S'
						 ORDER BY 
							   M.SEND_DATE DESC
			          ) A
		  		)
		  WHERE RNUM BETWEEN ? AND ?
	</entry>

</properties>