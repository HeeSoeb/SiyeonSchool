<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>

	<!-- 전체카테고리 조회 (공유주소록) -->
	<entry key="selectCategoryList">
	   SELECT
		      CATEGORY_NO
		    , CATEGORY_NAME
		 FROM CONTACTS_CATEGORY
		WHERE STATUS = 'Y'
	</entry>
	
	<!-- 개인주소록 조회: OWNER_NO가 가진 개인주소록 조회 -->
	<entry key="selectPrivateContactsList">
		SELECT 
		       C.CONTACTS_NO
		     , C.CONTACTS_NAME
		     , COUNT(CM.CONTACTS_NO) AS "COUNT"
		  FROM CONTACTS "C"
		  LEFT JOIN CONTACTS_MEMBER "CM" ON (C.CONTACTS_NO = CM.CONTACTS_NO)
		 WHERE C.OWNER_NO = ?
		   AND C.CONTACTS_TYPE = 'P'
		   AND C.STATUS = 'Y'
		 GROUP
		    BY C.CONTACTS_NO, 
		       C.CONTACTS_NAME
		 ORDER
            BY C.CONTACTS_NO
	</entry>
	
	<!-- 공유주소록 조회: CATEGORY_NO에 속한 공유주소록 조회 -->
	<entry key="selectPublicContactsList">
		SELECT 
		       C.CONTACTS_NO
		     , C.CONTACTS_NAME
		     , COUNT(CM.CONTACTS_NO) AS "COUNT"
		  FROM CONTACTS "C"
		  LEFT JOIN CONTACTS_MEMBER "CM" ON (C.CONTACTS_NO = CM.CONTACTS_NO)
		 WHERE C.CATEGORY_NO = ?
           AND C.CONTACTS_TYPE = 'S'
		   AND C.STATUS = 'Y'
		 GROUP
		    BY C.CONTACTS_NO, 
		       C.CONTACTS_NAME
         ORDER
            BY C.CONTACTS_NO
	</entry>
	
	<!-- 전체사용자 조회: CURRENT_USER_NO가 표시한 "별"포함 -->
	<entry key="selectAllUsersList">
		SELECT
		       U.USER_NO
		     , U.USER_ID
		     , U.USER_NAME
		     , CASE WHEN U.PHONE_PUBLIC = 'N' THEN '비공개'
		            ELSE U.PHONE
		       END AS "PHONE"
		     , TO_CHAR(U.BIRTHDAY, 'FMMM"월" DD"일"') AS "BIRTHDAY"
		     , U.PROFILE_FILE_NO
		     , CASE WHEN U.USER_AUTH = 'A' THEN '선생님'
		            ELSE '학생'
		       END AS "ROLE"
		     , CS.STAR
		  FROM USERS "U"
		  LEFT JOIN CONTACTS_STAR "CS" ON (U.USER_NO = CS.OTHER_USER_NO AND CS.CURRENT_USER_NO = ?)
		 WHERE U.STATUS = 'Y'
		 ORDER BY U.USER_AUTH, U.USER_NAME
	</entry>
	
	<!-- 주소록구성원 조회 -->
	<entry key="selectContactsUsersList">
		SELECT
		       U.USER_NO
		     , U.USER_ID
		     , U.USER_NAME
		     , CASE WHEN U.PHONE_PUBLIC = 'N' THEN '비공개'
		            ELSE U.PHONE
		       END AS "PHONE"
		     , TO_CHAR(U.BIRTHDAY, 'FMMM"월" DD"일"') "BIRTHDAY"
		     , U.PROFILE_FILE_NO
		     , CASE WHEN CM.ROLE = 'L' THEN '팀장'
		            WHEN CM.ROLE = 'F' THEN '팀원'
		            ELSE '-'
		       END AS "ROLE"
		     , CS.STAR
		  FROM USERS U
		  JOIN CONTACTS_MEMBER "CM" ON (U.USER_NO = CM.USER_NO)
		  LEFT JOIN CONTACTS_STAR "CS" ON (U.USER_NO = CS.OTHER_USER_NO AND CS.CURRENT_USER_NO = ?)
		 WHERE U.STATUS = 'Y'
		   AND CM.CONTACTS_NO = ?
		 ORDER BY CM.ROLE DESC, USER_NAME
	</entry>
	
	<!-- 카테고리구성원 조회: ex) 세미프로젝트 1조~5조 전체구성원 (모든 팀장 + 팀원) -->
	<entry key="selectCategoryUsersList">
		SELECT
		       U.USER_NO
		     , U.USER_ID
		     , U.USER_NAME
		     , CASE WHEN U.PHONE_PUBLIC = 'N' THEN '비공개'
		            ELSE U.PHONE
		       END AS "PHONE"
		     , TO_CHAR(U.BIRTHDAY, 'FMMM"월" DD"일"') "BIRTHDAY"
		     , U.PROFILE_FILE_NO
		     , CASE WHEN CM.ROLE = 'L' THEN '팀장'
		            WHEN CM.ROLE = 'F' THEN '팀원'
		            ELSE '-'
		       END AS "ROLE"
		     , CS.STAR
		  FROM USERS U
		  JOIN CONTACTS_MEMBER CM ON U.USER_NO = CM.USER_NO
		  LEFT JOIN CONTACTS_STAR CS ON U.USER_NO = CS.OTHER_USER_NO AND CS.CURRENT_USER_NO = ?
		 WHERE U.STATUS = 'Y'
		   AND CM.CONTACTS_NO IN (SELECT CONTACTS_NO FROM CONTACTS WHERE CATEGORY_NO = ?)
		 ORDER BY CM.ROLE DESC, U.USER_NAME
	</entry>

</properties>
